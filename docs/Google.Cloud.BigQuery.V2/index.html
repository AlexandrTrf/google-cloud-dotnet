<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Google.Cloud.BigQuery.V2 | Google.Cloud.BigQuery.V2 </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Google.Cloud.BigQuery.V2 | Google.Cloud.BigQuery.V2 ">
    <meta name="generator" content="docfx 2.50.0.0">
    
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="stylesheet" href="styles/docfx.vendor.css">
    <link rel="stylesheet" href="styles/docfx.css">
    <link rel="stylesheet" href="styles/main.css">
    <meta property="docfx:navrel" content="toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="index.html">
                <img id="logo" class="svg" src="logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="googlecloudbigqueryv2">Google.Cloud.BigQuery.V2</h1>

<p><code>Google.Cloud.BigQuery.V2</code> is a.NET client library for the <a href="https://cloud.google.com/bigquery/">Google BigQuery API</a>.
It wraps the <code>Google.Apis.Bigquery.v2</code> generated library, providing a higher-level API to make it easier to use.</p>
<p>Note:
This documentation is for version <code>2.2.0</code> of the library.
Some samples may not work with other versions.</p>
<h1 id="installation">Installation</h1>
<p>Install the <code>Google.Cloud.BigQuery.V2</code> package from NuGet. Add it to
your project in the normal way (for example by right-clicking on the
project in Visual Studio and choosing &quot;Manage NuGet Packages...&quot;).</p>
<h1 id="authentication">Authentication</h1>
<p>When running on Google Cloud Platform, no action needs to be taken to authenticate.</p>
<p>Otherwise, the simplest way of authenticating your API calls is to
download a service account JSON file then set the <code>GOOGLE_APPLICATION_CREDENTIALS</code> environment variable to refer to it.
The credentials will automatically be used to authenticate. See the <a href="https://cloud.google.com/docs/authentication/getting-started">Getting Started With
Authentication</a> guide for more details.</p>
<h1 id="getting-started">Getting started</h1>
<p>Common operations are exposed via the
<a href="api/Google.Cloud.BigQuery.V2.BigQueryClient.html">BigQueryClient</a>
class, and additional wrapper classes are present to make operations
with datasets, tables and query results simpler.</p>
<h1 id="client-life-cycle-management">Client life-cycle management</h1>
<p>In many cases you don&#39;t need to worry about disposing of
<code>BigQueryClient</code> objects, and can create them reasonably freely -
but be aware that this <em>can</em> causes issues with memory and network
connection usage. We advise you to reuse a single client object if
possible; if your architecture requires you to frequently create new
client objects, please dispose of them to help with timely resource
clean-up. See <a href="https://googleapis.github.io/google-cloud-dotnet/docs/guides/cleanup.html#rest-based-apis">the resource clean-up guide</a> for more
details.</p>
<h1 id="sample-code">Sample code</h1>
<h2 id="querying">Querying</h2>
<pre><code class="lang-cs">BigQueryClient client = BigQueryClient.Create(projectId);
BigQueryTable table = client.GetTable(&quot;bigquery-public-data&quot;, &quot;samples&quot;, &quot;shakespeare&quot;);

string sql = $&quot;SELECT corpus AS title, COUNT(word) AS unique_words FROM {table} GROUP BY title ORDER BY unique_words DESC LIMIT 10&quot;;
BigQueryParameter[] parameters = null;
BigQueryResults results = client.ExecuteQuery(sql, parameters);

foreach (BigQueryRow row in results)
{
    Console.WriteLine($&quot;{row[&quot;title&quot;]}: {row[&quot;unique_words&quot;]}&quot;);
}
</code></pre><h2 id="parameterized-queries">Parameterized queries</h2>
<p>Queries can be provided with parameters, either using names (the
default):</p>
<pre><code class="lang-cs">BigQueryClient client = BigQueryClient.Create(projectId);
BigQueryTable table = client.GetTable(datasetId, tableId);
string sql = $&quot;SELECT player, score, level FROM {table} WHERE score &gt;= @score AND level &gt;= @level&quot;;
BigQueryParameter[] parameters = new[]
{
    new BigQueryParameter(&quot;level&quot;, BigQueryDbType.Int64, 2),
    new BigQueryParameter(&quot;score&quot;, BigQueryDbType.Int64, 1500)
};
BigQueryResults results = client.ExecuteQuery(sql, parameters);
foreach (BigQueryRow row in results)
{
    Console.WriteLine($&quot;Name: {row[&quot;player&quot;]}; Score: {row[&quot;score&quot;]}; Level: {row[&quot;level&quot;]}&quot;);
}
</code></pre><p>Or using positional parameters:</p>
<pre><code class="lang-cs">BigQueryClient client = BigQueryClient.Create(projectId);
BigQueryTable table = client.GetTable(datasetId, tableId);
string sql = $&quot;SELECT player, score, level FROM {table} WHERE score &gt;= ? AND level &gt;= ?&quot;;
BigQueryParameter[] parameters = new[]
{
    new BigQueryParameter(BigQueryDbType.Int64, 1500), // For score
    new BigQueryParameter(BigQueryDbType.Int64, 2), // For level
};
QueryOptions queryOptions = new QueryOptions { ParameterMode = BigQueryParameterMode.Positional };
BigQueryResults results = client.ExecuteQuery(sql, parameters, queryOptions);
foreach (BigQueryRow row in results)
{
    Console.WriteLine($&quot;Name: {row[&quot;player&quot;]}; Score: {row[&quot;score&quot;]}; Level: {row[&quot;level&quot;]}&quot;);
}
</code></pre><h2 id="using-legacy-sql">Using legacy SQL</h2>
<p>By default, <a href="api/Google.Cloud.BigQuery.V2.BigQueryClient.html">BigQueryClient</a>
uses <a href="https://cloud.google.com/bigquery/sql-reference/">Standard SQL</a>. To
use <a href="https://cloud.google.com/bigquery/query-reference">Legacy SQL</a>,
simply set <code>UseLegacySql</code> to true in the query options, and make
sure that you use the legacy format for the table name, as shown
below.</p>
<pre><code class="lang-cs">BigQueryClient client = BigQueryClient.Create(projectId);
BigQueryTable table = client.GetTable(&quot;bigquery-public-data&quot;, &quot;samples&quot;, &quot;shakespeare&quot;);

string sql = $&quot;SELECT TOP(corpus, 10) AS title, COUNT(*) AS unique_words FROM {table:legacy}&quot;;
BigQueryParameter[] parameters = null;
BigQueryResults results = client.ExecuteQuery(sql, parameters, new QueryOptions { UseLegacySql = true });

foreach (BigQueryRow row in results)
{
    Console.WriteLine($&quot;{row[&quot;title&quot;]}: {row[&quot;unique_words&quot;]}&quot;);
}
</code></pre><h2 id="wildcard-queries">Wildcard queries</h2>
<p><a href="https://cloud.google.com/bigquery/docs/querying-wildcard-tables">Wildcard queries</a> can be used
to query multiple tables at the same time.
Wildcard table names only work in queries written using Standard SQL, so make sure to use the
standard format for the table name as shown below.</p>
<pre><code class="lang-cs">BigQueryClient client = BigQueryClient.Create(projectId);

string sql = $&quot;SELECT year, mo, da, temp, min, max FROM `bigquery-public-data.noaa_gsod.gsod*` where `max` &gt; 120 and `max` &lt; 121 LIMIT 10&quot;;
BigQueryParameter[] parameters = null;
BigQueryResults results = client.ExecuteQuery(sql, parameters);

foreach (BigQueryRow row in results)
{
    Console.WriteLine($&quot;On {row[&quot;year&quot;]}-{row[&quot;mo&quot;]}-{row[&quot;da&quot;]} the mean temperature was {row[&quot;temp&quot;]} with min temperature at {row[&quot;min&quot;]} and max temperature at {row[&quot;max&quot;]}.&quot;);
}
</code></pre><h2 id="data-insertion">Data insertion</h2>
<pre><code class="lang-cs">BigQueryClient client = BigQueryClient.Create(projectId);

// Create the dataset if it doesn&#39;t exist.
BigQueryDataset dataset = client.GetOrCreateDataset(&quot;mydata&quot;);

// Create the table if it doesn&#39;t exist.
BigQueryTable table = dataset.GetOrCreateTable(&quot;scores&quot;, new TableSchemaBuilder
{
    { &quot;player&quot;, BigQueryDbType.String },
    { &quot;gameStarted&quot;, BigQueryDbType.Timestamp },
    { &quot;score&quot;, BigQueryDbType.Int64 }
}.Build());

// Insert a single row. There are many other ways of inserting
// data into a table.
table.InsertRow(new BigQueryInsertRow
{
    { &quot;player&quot;, &quot;Bob&quot; },
    { &quot;score&quot;, 85 },
    { &quot;gameStarted&quot;, new DateTime(2000, 1, 14, 10, 30, 0, DateTimeKind.Utc) }
});
</code></pre><h2 id="dml">DML</h2>
<p>BigQuery supports
<a href="https://cloud.google.com/bigquery/docs/reference/standard-sql/data-manipulation-language">DML</a>.</p>
<p>Suppose we have a high score table, and we realize that on one day
we accidentally recorded incorrect scores: each player was only
awarded half the score they actually earned. We can update the data
afterwards using DML:</p>
<pre><code class="lang-cs">BigQueryClient client = BigQueryClient.Create(projectId);
BigQueryTable table = client.GetTable(datasetId, tableId);
BigQueryResults result = client.ExecuteQuery(
    $&quot;UPDATE {table} SET score = score * 2 WHERE DATE(game_started) = @date&quot;,
    new[] { new BigQueryParameter(&quot;date&quot;, BigQueryDbType.Date, new DateTime(2013, 6, 1)) })
    .ThrowOnAnyError();
Console.WriteLine($&quot;Modified {result.NumDmlAffectedRows} row(s)&quot;);
</code></pre><h3 id="important-note-on-the-result-returned-by-dml-operations-in-version-130">Important note on the result returned by DML operations (in version 1.3.0)</h3>
<p>In version 1.3.0, iterating over the results of a <code>BigQueryResults</code> object returned
from a DML operation will iterate over the entire table modified by
that operation. This is a side-effect of the way the underlying API
is called, but it&#39;s rarely useful to iterate over the results. The
<code>NumDmlAffectedRows</code> property of the results object is useful,
however, in determining how many rows were modified.</p>
<p>From version 1.4.0-beta01 onwards, the <code>BigQueryResults</code> object
returned from a DML operation returns no rows, but
<code>NumDmlAffectedRows</code> still returns the number of affected rows.</p>
<h2 id="creating-a-table-partitioned-by-time">Creating a table partitioned by time</h2>
<pre><code class="lang-cs">BigQueryClient client = BigQueryClient.Create(projectId);
TableSchema schema = new TableSchemaBuilder
{
    { &quot;message&quot;, BigQueryDbType.String }
}.Build();
Table tableToCreate = new Table 
{ 
    TimePartitioning = TimePartition.CreateDailyPartitioning(expiration: null),
    Schema = schema
};
BigQueryTable table = client.CreateTable(datasetId, tableId, tableToCreate);
// Upload a single row to the table, using JSON rather than the streaming buffer, as
// the _PARTITIONTIME column will be null while it&#39;s being served from the streaming buffer.
// This code assumes the upload succeeds; normally, you should check the job results.
table.UploadJson(new[] { &quot;{ \&quot;message\&quot;: \&quot;Sample message\&quot; }&quot; }).PollUntilCompleted();

BigQueryResults results = client.ExecuteQuery(
    $&quot;SELECT message, _PARTITIONTIME AS pt FROM {table}&quot;,
    parameters: null);
List&lt;BigQueryRow&gt; rows = results.ToList();
foreach (BigQueryRow row in rows)
{
    string message = (string) row[&quot;message&quot;];
    DateTime partition = (DateTime) row[&quot;pt&quot;];
    Console.WriteLine($&quot;Message: {message}; partition: {partition:yyyy-MM-dd}&quot;);
}
</code></pre><h2 id="querying-an-external-data-source">Querying an external data source</h2>
<p>As <a href="https://cloud.google.com/bigquery/external-data-sources">described in the
documentation</a>,
BigQuery can query some external data sources. The sample code below
demonstrates querying a CSV file stored in Google Cloud Storage.</p>
<pre><code class="lang-cs">BigQueryClient client = BigQueryClient.Create(projectId);
TableSchema schema = new TableSchemaBuilder
{
    { &quot;name&quot;, BigQueryDbType.String },
    { &quot;score&quot;, BigQueryDbType.Int64 }
}.Build();
Table tableToCreate = new Table
{
    ExternalDataConfiguration = new ExternalDataConfiguration
    {
        SourceFormat = &quot;CSV&quot;,
        SourceUris = new[] { $&quot;gs://{bucket}/{objectName}&quot; }
    },
    Schema = schema
};
BigQueryTable table = client.CreateTable(datasetId, tableId, tableToCreate);
BigQueryParameter[] parameters = null;
List&lt;BigQueryRow&gt; rows = client.ExecuteQuery($&quot;SELECT name, score FROM {table} ORDER BY score&quot;, parameters).ToList();
foreach (BigQueryRow row in rows)
{
    Console.WriteLine($&quot;{row[&quot;name&quot;]} - {row[&quot;score&quot;]}&quot;);
}
</code></pre></article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
             
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="styles/docfx.js"></script>
    <script type="text/javascript" src="styles/main.js"></script>
  </body>
</html>
